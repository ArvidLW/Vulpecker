--- httpd/httpd/branches/2.0.x/modules/mappers/mod_imap.c	2005/12/12 16:36:54	356278
+++ httpd/httpd/branches/2.0.x/modules/mappers/mod_imap.c	2005/12/12 16:41:53	356279
@@ -342,7 +342,7 @@
     if (!strcasecmp(value, "referer")) {
         referer = apr_table_get(r->headers_in, "Referer");
         if (referer && *referer) {
-	    return apr_pstrdup(r->pool, referer);
+	    return ap_escape_html(r->pool, referer);
         }
         else {
 	    /* XXX:  This used to do *value = '\0'; ... which is totally bogus