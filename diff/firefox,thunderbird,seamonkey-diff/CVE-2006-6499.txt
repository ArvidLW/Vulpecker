--- js/src/jsdtoa.c	13 Jul 2006 19:18:01 -0000	3.34
+++ js/src/jsdtoa.c	9 Nov 2006 18:09:22 -0000
@@ -2381,7 +2381,9 @@
                 goto no_digits;
             goto one_digit;
         }
-        for(i = 1;; i++) {
+
+        /* Use true number of digits to limit looping. */
+        for(i = 1; i<=k+1; i++) {
             L = (Long) (d / ds);
             d -= L*ds;
 #ifdef Check_FLT_ROUNDS
@@ -2406,8 +2408,7 @@
                 }
                 break;
             }
-            if (!(d *= 10.))
-                break;
+            d *= 10.;
         }
         goto ret1;
     }
