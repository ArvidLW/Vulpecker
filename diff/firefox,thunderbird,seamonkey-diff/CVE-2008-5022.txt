--- content/base/src/nsXMLHttpRequest.cpp	7 Oct 2008 16:34:20 -0000	1.243
+++ content/base/src/nsXMLHttpRequest.cpp	15 Oct 2008 11:50:01 -0000
@@ -1001,20 +1001,16 @@ nsXMLHttpRequest::NotifyEventListeners(c
   // XXXbz wouldn't it be easier to just have an actual nsEventListenerManager
   // to work with or something?  I feel like we're duplicating code here...
   if (!aEvent)
     return;
 
   nsCOMPtr<nsIJSContextStack> stack;
   JSContext *cx = nsnull;
 
-  if (NS_FAILED(CheckInnerWindowCorrectness())) {
-    return;
-  }
-
   if (mScriptContext) {
     stack = do_GetService("@mozilla.org/js/xpc/ContextStack;1");
 
     if (stack) {
       cx = (JSContext *)mScriptContext->GetNativeContext();
 
       if (cx) {
         stack->Push(cx);
@@ -1022,16 +1018,19 @@ nsXMLHttpRequest::NotifyEventListeners(c
     }
   }
 
   PRInt32 count = aListeners.Count();
   for (PRInt32 index = 0; index < count; ++index) {
     nsIDOMEventListener* listener = aListeners[index];
     
     if (listener) {
+      if (NS_FAILED(CheckInnerWindowCorrectness())) {
+        break;
+      }
       listener->HandleEvent(aEvent);
     }
   }
 
   if (cx) {
     stack->Pop(&cx);
   }
 }
