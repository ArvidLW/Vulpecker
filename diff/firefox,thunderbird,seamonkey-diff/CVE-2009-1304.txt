--- a/js/src/jsobj.cpp	Wed Nov 26 20:13:43 2008 +0100
+++ b/js/src/jsobj.cpp	Thu Nov 27 01:30:11 2008 +0100
@@ -3548,6 +3548,8 @@
             protoIndex =
                 js_LookupPropertyWithFlags(cx, obj, id, cx->resolveFlags,
                                            &pobj, &prop);
+            if (protoIndex < 0)
+                return -1;
         } else {
             if (!OBJ_LOOKUP_PROPERTY(cx, obj, id, &pobj, &prop))
                 return -1;
