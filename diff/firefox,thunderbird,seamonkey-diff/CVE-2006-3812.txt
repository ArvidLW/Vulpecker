--- chrome/src/nsChromeRegistry.cpp	26 Jan 2006 01:07:37 -0000	1.346
+++ chrome/src/nsChromeRegistry.cpp	16 May 2006 08:48:43 -0000
@@ -666,26 +666,33 @@ nsChromeRegistry::Canonify(nsIURL* aChro
     }
     else if (provider.EqualsLiteral("locale")) {
       path.AppendLiteral(".dtd");
     }
     else if (provider.EqualsLiteral("skin")) {
       path.AppendLiteral(".css");
     }
     else {
       return NS_ERROR_INVALID_ARG;
     }
     aChromeURL->SetPath(path);
   }
-  else if (path.Find(NS_LITERAL_CSTRING("..")) != -1) {
-    return NS_ERROR_DOM_BAD_URI;
+  else {
+    nsCAutoString filePath;
+    rv = aChromeURL->GetFilePath(filePath);
+    NS_ENSURE_SUCCESS(rv, rv);
+
+    if (filePath.Find(NS_LITERAL_CSTRING("..")) != -1 ||
+        filePath.FindChar(':') != -1) {
+      return NS_ERROR_DOM_BAD_URI;
+    }
   }
 
   return NS_OK;
 }
 
 NS_IMETHODIMP
 nsChromeRegistry::ConvertChromeURL(nsIURI* aChromeURI, nsIURI* *aResult)
 {
   nsresult rv;
   NS_ASSERTION(aChromeURI, "null url!");
 
   if (mOverrideTable.Get(aChromeURI, aResult))
