diff --git a/js/src/jsstr.cpp b/js/src/jsstr.cpp
--- a/js/src/jsstr.cpp
+++ b/js/src/jsstr.cpp
@@ -1791,16 +1791,19 @@ js_StringReplaceHelper(JSContext *cx, ui
      * special meanings) UNLESS the first arg is a RegExp object.
      */
     rdata.base.flags = MODE_REPLACE | KEEP_REGEXP | FORCE_FLAT;
     rdata.base.optarg = 2;
 
     rdata.lambda = lambda;
     rdata.repstr = repstr;
     if (repstr) {
+        /* We're about to store pointers into the middle of our string. */
+        if (!js_MakeStringImmutable(cx, repstr))
+            return JS_FALSE;
         rdata.dollarEnd = repstr->chars() + repstr->length();
         rdata.dollar = js_strchr_limit(repstr->chars(), '$',
                                        rdata.dollarEnd);
     } else {
         rdata.dollar = rdata.dollarEnd = NULL;
     }
     rdata.chars = NULL;
     rdata.length = 0;
