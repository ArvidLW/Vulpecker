diff --git a/xpcom/ds/nsCRT.cpp b/xpcom/ds/nsCRT.cpp
--- a/xpcom/ds/nsCRT.cpp
+++ b/xpcom/ds/nsCRT.cpp
@@ -301,16 +301,24 @@ PRUint32 nsCRT::HashCodeAsUTF8(const PRU
             {
               // Treat broken characters as the Unicode replacement
               // character 0xFFFD
               U = 0xFFFD;
 
               code_length = 3;
 
               NS_WARNING("High surrogate not followed by low surrogate");
+
+              // The pointer to the next character points to the second 16-bit
+              // value, not beyond it, as per Unicode 5.0.0 Chapter 3 C10, only
+              // the first code unit of an illegal sequence must be treated as
+              // an illegally terminated code unit sequence (also Chapter 3
+              // D91, "isolated [not paired and ill-formed] UTF-16 code units
+              // in the range D800..DFFF are ill-formed").
+              --s;
             }
 
           W1 = 0;
         }
 
 
       static const PRUint16 sBytePrefix[5]  = { 0x0000, 0x0000, 0x00C0, 0x00E0, 0x00F0  };
       static const PRUint16 sShift[5]       = { 0, 0, 6, 12, 18 };
