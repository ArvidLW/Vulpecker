--- xpfe/components/search/src/nsInternetSearchService.cpp	14 Oct 2004 06:22:12 -0000	1.207.6.9
+++ xpfe/components/search/src/nsInternetSearchService.cpp	12 Apr 2005 19:14:36 -0000
@@ -2711,18 +2711,24 @@ InternetSearchDataSource::GetInternetSea
 				}
 			}
 			Recycle(utf8data);
 		}
 	}
 	
 	nsAutoString	action, input, method, userVar, name;
 	if (NS_FAILED(rv = GetData(dataUni, "search", 0, "action", action)))
 	    return(rv);
+
+    // Search only supports the http protocol
+    if (!StringBeginsWith(action, NS_LITERAL_STRING("http:")) &&
+        !StringBeginsWith(action, NS_LITERAL_STRING("https:")))
+        return NS_ERROR_UNEXPECTED;
+
 	if (NS_FAILED(rv = GetData(dataUni, "search", 0, "method", method)))
 	    return(rv);
   if (NS_FAILED(rv = GetData(dataUni, "search", 0, "name", name)))
       return(rv);
 	if (NS_FAILED(rv = GetInputs(dataUni, name, userVar, text, input, direction, pageNumber, whichButtons)))
 	    return(rv);
 	if (input.IsEmpty())				return(NS_ERROR_UNEXPECTED);
 
 	// we can only handle HTTP GET