--- nsExternalHelperAppService.cpp	24 Jul 2007 21:31:24 -0000	1.322
+++ nsExternalHelperAppService.cpp	25 Jul 2007 19:22:09 -0000
@@ -1210,16 +1210,19 @@ class nsExternalLoadRequest : public nsR
     nsCOMPtr<nsIPrompt> mPrompt;
 };
 
 NS_IMETHODIMP nsExternalHelperAppService::LoadURI(nsIURI * aURL, nsIPrompt * aPrompt)
 {
   nsCAutoString spec;
   aURL->GetSpec(spec);
 
+  if (spec.Find("%00") != -1)
+    return NS_ERROR_MALFORMED_URI;
+
   spec.ReplaceSubstring("\"", "%22");
   spec.ReplaceSubstring("`", "%60");
 
   nsCOMPtr<nsIIOService> ios(do_GetIOService());
   nsCOMPtr<nsIURI> uri;
   nsresult rv = ios->NewURI(spec, nsnull, nsnull, getter_AddRefs(uri));
   NS_ENSURE_SUCCESS(rv, rv);
 
