--- jsstr.c	19 Apr 2006 23:36:16 -0000	3.125
+++ jsstr.c	26 Apr 2006 20:02:38 -0000
@@ -2181,16 +2061,21 @@ tagify(JSContext *cx, JSObject *obj, jsv
     parlen = 0; /* Avoid warning. */
     if (param) {
         parlen = JSSTRING_LENGTH(param);
         taglen += 2 + parlen + 1;                       /* '="param"' */
     }
     endlen = strlen(end);
     taglen += JSSTRING_LENGTH(str) + 2 + endlen + 1;    /* 'str</end>' */
 
+    if (taglen >= ~(size_t)0 / sizeof(jschar)) {
+        JS_ReportOutOfMemory(cx);
+        return JS_FALSE;
+    }
+
     tagbuf = (jschar *) JS_malloc(cx, (taglen + 1) * sizeof(jschar));
     if (!tagbuf)
         return JS_FALSE;
 
     j = 0;
     tagbuf[j++] = '<';
     for (i = 0; i < beglen; i++)
         tagbuf[j++] = (jschar)begin[i];
